# Guia de Configura√ß√£o - Kubernetes DigitalOcean

Este guia fornece instru√ß√µes detalhadas sobre como configurar as vari√°veis do Terraform para upgrades de Kubernetes na DigitalOcean.

## üéØ Vis√£o Geral

Este guia aborda:
- Como configurar vari√°veis no Terraform
- Exemplos para diferentes cen√°rios (dev, staging, prod)
- Considera√ß√µes de seguran√ßa e performance
- Troubleshooting comum

## üìÅ Estrutura de Arquivos Terraform

### Organiza√ß√£o Recomendada

```
terraform/
‚îú‚îÄ‚îÄ environments/
‚îÇ   ‚îú‚îÄ‚îÄ development/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îú‚îÄ‚îÄ staging/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.tf
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ variables.tf
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ terraform.tfvars
‚îÇ   ‚îî‚îÄ‚îÄ production/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ       ‚îî‚îÄ‚îÄ terraform.tfvars
‚îú‚îÄ‚îÄ modules/
‚îÇ   ‚îî‚îÄ‚îÄ do-kubernetes/
‚îÇ       ‚îú‚îÄ‚îÄ main.tf
‚îÇ       ‚îú‚îÄ‚îÄ variables.tf
‚îÇ       ‚îî‚îÄ‚îÄ outputs.tf
‚îî‚îÄ‚îÄ shared/
    ‚îú‚îÄ‚îÄ versions.tf
    ‚îî‚îÄ‚îÄ providers.tf
```

## üîß Configura√ß√£o de Vari√°veis

### 1. Arquivo `variables.tf`

```hcl
# =============================================================================
# CONFIGURA√á√ïES GERAIS DO CLUSTER
# =============================================================================

variable "cluster_name" {
  description = "Nome do cluster Kubernetes"
  type        = string
  validation {
    condition     = can(regex("^[a-z0-9-]+$", var.cluster_name))
    error_message = "O nome do cluster deve conter apenas letras min√∫sculas, n√∫meros e h√≠fens."
  }
}

variable "region" {
  description = "Regi√£o da DigitalOcean para o cluster"
  type        = string
  default     = "nyc1"
  validation {
    condition = contains([
      "nyc1", "nyc3", "ams3", "fra1", "lon1", 
      "sfo3", "sgp1", "tor1", "blr1", "syd1"
    ], var.region)
    error_message = "Regi√£o deve ser uma regi√£o v√°lida da DigitalOcean."
  }
}

variable "kubernetes_version" {
  description = "Vers√£o do Kubernetes"
  type        = string
  default     = "1.28.2-do.0"
  validation {
    condition     = can(regex("^\\d+\\.\\d+\\.\\d+-do\\.\\d+$", var.kubernetes_version))
    error_message = "Vers√£o deve seguir o formato: x.y.z-do.n"
  }
}

# =============================================================================
# CONFIGURA√á√ïES DE UPGRADE
# =============================================================================

variable "auto_upgrade_enabled" {
  description = "Habilita upgrade autom√°tico do control plane"
  type        = bool
  default     = false
}

variable "surge_upgrade_enabled" {
  description = "Habilita surge upgrade para zero downtime"
  type        = bool
  default     = false
}

variable "maintenance_policy" {
  description = "Pol√≠tica de manuten√ß√£o para upgrades autom√°ticos"
  type = object({
    start_time = string
    day        = string
  })
  default = {
    start_time = "04:00"
    day        = "sunday"
  }
  validation {
    condition = contains([
      "monday", "tuesday", "wednesday", "thursday",
      "friday", "saturday", "sunday", "any"
    ], var.maintenance_policy.day)
    error_message = "Dia deve ser um dia da semana v√°lido ou 'any'."
  }
  validation {
    condition     = can(regex("^([01]?[0-9]|2[0-3]):[0-5][0-9]$", var.maintenance_policy.start_time))
    error_message = "Hor√°rio deve estar no formato HH:MM (24h)."
  }
}

variable "surge_config" {
  description = "Configura√ß√µes detalhadas do surge upgrade"
  type = object({
    max_surge       = string
    max_unavailable = string
  })
  default = {
    max_surge       = "1"
    max_unavailable = "0"
  }
}

# =============================================================================
# CONFIGURA√á√ïES DE NODE POOL
# =============================================================================

variable "node_pools" {
  description = "Configura√ß√£o dos node pools"
  type = map(object({
    size           = string
    node_count     = number
    min_nodes      = number
    max_nodes      = number
    auto_scale     = bool
    tags           = list(string)
    labels         = map(string)
    taints = list(object({
      key    = string
      value  = string
      effect = string
    }))
  }))
  default = {
    primary = {
      size       = "s-2vcpu-2gb"
      node_count = 3
      min_nodes  = 3
      max_nodes  = 5
      auto_scale = true
      tags       = ["primary", "worker"]
      labels     = { role = "worker" }
      taints     = []
    }
  }
}

# =============================================================================
# CONFIGURA√á√ïES DE SEGURAN√áA
# =============================================================================

variable "enable_private_cluster" {
  description = "Habilita cluster privado (nodes sem IP p√∫blico)"
  type        = bool
  default     = false
}

variable "vpc_uuid" {
  description = "UUID da VPC para o cluster (opcional)"
  type        = string
  default     = null
}

variable "service_subnet" {
  description = "Subnet CIDR para services (opcional)"
  type        = string
  default     = null
  validation {
    condition     = var.service_subnet == null || can(cidrhost(var.service_subnet, 0))
    error_message = "service_subnet deve ser um CIDR v√°lido."
  }
}

variable "pod_subnet" {
  description = "Subnet CIDR para pods (opcional)"
  type        = string
  default     = null
  validation {
    condition     = var.pod_subnet == null || can(cidrhost(var.pod_subnet, 0))
    error_message = "pod_subnet deve ser um CIDR v√°lido."
  }
}

# =============================================================================
# TAGS E METADADOS
# =============================================================================

variable "environment" {
  description = "Ambiente (dev, staging, prod)"
  type        = string
  validation {
    condition     = contains(["dev", "development", "staging", "prod", "production"], var.environment)
    error_message = "Ambiente deve ser: dev, development, staging, prod, ou production."
  }
}

variable "project" {
  description = "Nome do projeto"
  type        = string
  default     = "default"
}

variable "cost_center" {
  description = "Centro de custo para billing"
  type        = string
  default     = "engineering"
}

variable "additional_tags" {
  description = "Tags adicionais para recursos"
  type        = list(string)
  default     = []
}
```

### 2. Arquivo Principal `main.tf`

```hcl
# =============================================================================
# PROVEDOR E VERS√ïES
# =============================================================================

terraform {
  required_version = ">= 1.0"
  required_providers {
    digitalocean = {
      source  = "digitalocean/digitalocean"
      version = "~> 2.32"
    }
  }
}

# =============================================================================
# DATA SOURCES
# =============================================================================

data "digitalocean_kubernetes_versions" "current" {
  version_prefix = "1.28."
}

data "digitalocean_vpc" "main" {
  count = var.vpc_uuid != null ? 1 : 0
  id    = var.vpc_uuid
}

# =============================================================================
# LOCALS
# =============================================================================

locals {
  # Tags padr√£o para todos os recursos
  default_tags = [
    "environment:${var.environment}",
    "project:${var.project}",
    "cost-center:${var.cost_center}",
    "managed-by:terraform"
  ]
  
  # Combina tags padr√£o com tags adicionais
  all_tags = concat(local.default_tags, var.additional_tags)
  
  # Configura√ß√£o condicional baseada no ambiente
  upgrade_config = {
    development = {
      auto_upgrade  = true
      surge_upgrade = false
    }
    staging = {
      auto_upgrade  = true
      surge_upgrade = true
    }
    production = {
      auto_upgrade  = var.auto_upgrade_enabled
      surge_upgrade = var.surge_upgrade_enabled
    }
  }
  
  # Seleciona configura√ß√£o baseada no ambiente
  current_config = local.upgrade_config[var.environment] != null ? 
    local.upgrade_config[var.environment] : 
    local.upgrade_config["production"]
}

# =============================================================================
# CLUSTER KUBERNETES
# =============================================================================

resource "digitalocean_kubernetes_cluster" "main" {
  name     = var.cluster_name
  region   = var.region
  version  = var.kubernetes_version
  
  # Configura√ß√µes de upgrade
  auto_upgrade  = local.current_config.auto_upgrade
  surge_upgrade = local.current_config.surge_upgrade
  
  # Pol√≠tica de manuten√ß√£o (aplicada apenas se auto_upgrade = true)
  dynamic "maintenance_policy" {
    for_each = local.current_config.auto_upgrade ? [1] : []
    content {
      start_time = var.maintenance_policy.start_time
      day        = var.maintenance_policy.day
    }
  }
  
  # Configura√ß√µes de rede
  vpc_uuid = var.vpc_uuid
  
  # Tags
  tags = local.all_tags
  
  # Node pool padr√£o (ser√° removido ap√≥s cria√ß√£o de pools dedicados)
  node_pool {
    name       = "default-pool"
    size       = "s-1vcpu-2gb"
    node_count = 1
    
    tags = concat(local.all_tags, ["default-pool", "temporary"])
  }
  
  # Lifecycle para evitar recria√ß√£o desnecess√°ria
  lifecycle {
    ignore_changes = [
      node_pool  # Ignorar mudan√ßas no pool padr√£o
    ]
  }
}

# =============================================================================
# NODE POOLS DEDICADOS
# =============================================================================

resource "digitalocean_kubernetes_node_pool" "pools" {
  for_each = var.node_pools
  
  cluster_id = digitalocean_kubernetes_cluster.main.id
  
  name       = each.key
  size       = each.value.size
  node_count = each.value.node_count
  
  # Auto scaling
  auto_scale = each.value.auto_scale
  min_nodes  = each.value.auto_scale ? each.value.min_nodes : null
  max_nodes  = each.value.auto_scale ? each.value.max_nodes : null
  
  # Labels personalizados
  labels = merge(
    each.value.labels,
    {
      "node-pool"   = each.key
      "environment" = var.environment
      "project"     = var.project
    }
  )
  
  # Taints
  dynamic "taint" {
    for_each = each.value.taints
    content {
      key    = taint.value.key
      value  = taint.value.value
      effect = taint.value.effect
    }
  }
  
  # Tags
  tags = concat(
    local.all_tags,
    each.value.tags,
    ["node-pool:${each.key}"]
  )
}

# =============================================================================
# OUTPUTS
# =============================================================================

output "cluster_id" {
  description = "ID do cluster Kubernetes"
  value       = digitalocean_kubernetes_cluster.main.id
}

output "cluster_name" {
  description = "Nome do cluster Kubernetes"
  value       = digitalocean_kubernetes_cluster.main.name
}

output "cluster_endpoint" {
  description = "Endpoint da API do cluster"
  value       = digitalocean_kubernetes_cluster.main.endpoint
}

output "cluster_status" {
  description = "Status do cluster"
  value       = digitalocean_kubernetes_cluster.main.status
}

output "cluster_version" {
  description = "Vers√£o do Kubernetes do cluster"
  value       = digitalocean_kubernetes_cluster.main.version
}

output "node_pools" {
  description = "Informa√ß√µes dos node pools"
  value = {
    for k, v in digitalocean_kubernetes_node_pool.pools : k => {
      id         = v.id
      name       = v.name
      size       = v.size
      node_count = v.node_count
      nodes      = v.nodes
    }
  }
}

output "kubeconfig" {
  description = "Kubeconfig para acesso ao cluster"
  value       = digitalocean_kubernetes_cluster.main.kube_config[0].raw_config
  sensitive   = true
}
```

## üåç Configura√ß√µes por Ambiente

### Desenvolvimento (`environments/development/terraform.tfvars`)

```hcl
# =============================================================================
# CONFIGURA√á√ïES DE DESENVOLVIMENTO
# =============================================================================

cluster_name        = "dev-k8s-cluster"
region             = "fra1"
kubernetes_version = "1.28.2-do.0"
environment        = "development"
project           = "meu-projeto"

# Upgrades: Auto habilitado para testing, surge desabilitado para economia
auto_upgrade_enabled  = true
surge_upgrade_enabled = false

# Manuten√ß√£o pode ser em qualquer dia (ambiente de dev)
maintenance_policy = {
  start_time = "02:00"
  day        = "any"
}

# Node pools menores para desenvolvimento
node_pools = {
  workers = {
    size       = "s-2vcpu-2gb"
    node_count = 2
    min_nodes  = 1
    max_nodes  = 3
    auto_scale = true
    tags       = ["development", "workers"]
    labels     = { role = "worker", tier = "development" }
    taints     = []
  }
}

# Tags espec√≠ficas de desenvolvimento
additional_tags = [
  "auto-shutdown:enabled",
  "cost-optimization:aggressive"
]
```

### Staging (`environments/staging/terraform.tfvars`)

```hcl
# =============================================================================
# CONFIGURA√á√ïES DE STAGING
# =============================================================================

cluster_name        = "staging-k8s-cluster"
region             = "fra1"
kubernetes_version = "1.28.2-do.0"
environment        = "staging"
project           = "meu-projeto"

# Upgrades: Ambos habilitados para simular produ√ß√£o
auto_upgrade_enabled  = true
surge_upgrade_enabled = true

# Manuten√ß√£o antes do hor√°rio de produ√ß√£o
maintenance_policy = {
  start_time = "01:00"
  day        = "saturday"
}

# Configura√ß√£o de surge mais conservadora
surge_config = {
  max_surge       = "1"
  max_unavailable = "0"
}

# Node pools similares √† produ√ß√£o mas menores
node_pools = {
  workers = {
    size       = "s-2vcpu-4gb"
    node_count = 3
    min_nodes  = 2
    max_nodes  = 5
    auto_scale = true
    tags       = ["staging", "workers"]
    labels     = { role = "worker", tier = "staging" }
    taints     = []
  }
  
  # Pool adicional para teste de workloads espec√≠ficos
  specialized = {
    size       = "s-4vcpu-8gb"
    node_count = 1
    min_nodes  = 0
    max_nodes  = 2
    auto_scale = true
    tags       = ["staging", "specialized"]
    labels     = { role = "worker", tier = "staging", workload = "specialized" }
    taints = [
      {
        key    = "workload-type"
        value  = "specialized"
        effect = "NoSchedule"
      }
    ]
  }
}

# Tags de staging
additional_tags = [
  "testing:enabled",
  "pre-production:true"
]
```

### Produ√ß√£o (`environments/production/terraform.tfvars`)

```hcl
# =============================================================================
# CONFIGURA√á√ïES DE PRODU√á√ÉO
# =============================================================================

cluster_name        = "prod-k8s-cluster"
region             = "fra1"
kubernetes_version = "1.28.2-do.0"
environment        = "production"
project           = "meu-projeto"

# Upgrades: Controlados manualmente em produ√ß√£o
auto_upgrade_enabled  = false  # Controle manual para produ√ß√£o
surge_upgrade_enabled = true   # Zero downtime √© cr√≠tico

# Manuten√ß√£o em hor√°rio de menor tr√°fego
maintenance_policy = {
  start_time = "04:00"
  day        = "sunday"
}

# Configura√ß√£o conservadora de surge
surge_config = {
  max_surge       = "25%"  # Surge mais controlado
  max_unavailable = "0"    # Zero indisponibilidade
}

# Node pools robustos para produ√ß√£o
node_pools = {
  # Pool principal para workloads gerais
  general = {
    size       = "s-4vcpu-8gb"
    node_count = 5
    min_nodes  = 5
    max_nodes  = 10
    auto_scale = true
    tags       = ["production", "general", "primary"]
    labels     = { 
      role = "worker"
      tier = "production"
      workload = "general"
    }
    taints = []
  }
  
  # Pool para workloads de alta performance
  compute = {
    size       = "c-8vcpu-16gb"
    node_count = 3
    min_nodes  = 2
    max_nodes  = 8
    auto_scale = true
    tags       = ["production", "compute", "high-performance"]
    labels     = {
      role = "worker"
      tier = "production"
      workload = "compute-intensive"
    }
    taints = [
      {
        key    = "workload-type"
        value  = "compute-intensive"
        effect = "NoSchedule"
      }
    ]
  }
  
  # Pool para workloads de alta mem√≥ria
  memory = {
    size       = "m-4vcpu-32gb"
    node_count = 2
    min_nodes  = 1
    max_nodes  = 5
    auto_scale = true
    tags       = ["production", "memory", "high-memory"]
    labels     = {
      role = "worker"
      tier = "production"
      workload = "memory-intensive"
    }
    taints = [
      {
        key    = "workload-type"
        value  = "memory-intensive"
        effect = "NoSchedule"
      }
    ]
  }
}

# Configura√ß√µes de rede para produ√ß√£o
enable_private_cluster = true
vpc_uuid              = "your-vpc-uuid-here"
service_subnet        = "10.244.0.0/16"
pod_subnet           = "10.244.64.0/18"

# Tags de produ√ß√£o
additional_tags = [
  "backup:required",
  "monitoring:enhanced",
  "sla:high",
  "disaster-recovery:enabled"
]
```

## üîê Considera√ß√µes de Seguran√ßa

### 1. Gerenciamento de Credenciais

```hcl
# providers.tf
provider "digitalocean" {
  # Nunca hardcode tokens!
  # Use vari√°veis de ambiente: DIGITALOCEAN_TOKEN
  # Ou configure via terraform cloud/enterprise
}

# Para CI/CD, use service accounts com permiss√µes m√≠nimas
variable "do_token" {
  description = "DigitalOcean API Token"
  type        = string
  sensitive   = true
}
```

### 2. Network Security

```hcl
# Configura√ß√£o para cluster privado
resource "digitalocean_vpc" "main" {
  name   = "${var.project}-${var.environment}-vpc"
  region = var.region
  
  ip_range = "10.10.0.0/16"
  
  tags = local.all_tags
}

# Firewall para nodes do cluster
resource "digitalocean_firewall" "cluster" {
  name = "${var.cluster_name}-firewall"
  
  tags = [digitalocean_kubernetes_cluster.main.node_pool[0].tags[0]]
  
  # Regras de entrada restritivas
  inbound_rule {
    protocol         = "tcp"
    port_range       = "22"
    source_addresses = ["your-office-ip/32"]  # SSH apenas do escrit√≥rio
  }
  
  inbound_rule {
    protocol         = "tcp"
    port_range       = "80"
    source_addresses = ["0.0.0.0/0", "::/0"]  # HTTP p√∫blico
  }
  
  inbound_rule {
    protocol         = "tcp"
    port_range       = "443"
    source_addresses = ["0.0.0.0/0", "::/0"]  # HTTPS p√∫blico
  }
  
  # Permitir tr√°fego interno do cluster
  inbound_rule {
    protocol    = "tcp"
    port_range  = "1-65535"
    source_tags = [digitalocean_kubernetes_cluster.main.node_pool[0].tags[0]]
  }
  
  # Regras de sa√≠da (permitir tudo por padr√£o)
  outbound_rule {
    protocol              = "tcp"
    port_range            = "1-65535"
    destination_addresses = ["0.0.0.0/0", "::/0"]
  }
  
  outbound_rule {
    protocol              = "udp"
    port_range            = "1-65535"
    destination_addresses = ["0.0.0.0/0", "::/0"]
  }
}
```

### 3. RBAC e Pod Security

```yaml
# rbac.yaml - Exemplo de configura√ß√£o RBAC
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  name: limited-cluster-reader
rules:
- apiGroups: [""]
  resources: ["nodes", "pods"]
  verbs: ["get", "list", "watch"]
- apiGroups: ["apps"]
  resources: ["deployments", "replicasets"]
  verbs: ["get", "list", "watch"]

---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: monitoring-sa
  namespace: monitoring

---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: monitoring-binding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: limited-cluster-reader
subjects:
- kind: ServiceAccount
  name: monitoring-sa
  namespace: monitoring
```

## ‚ö° Considera√ß√µes de Performance

### 1. Sizing Apropriado

```hcl
# Tabela de refer√™ncia para sizing de nodes
locals {
  node_sizes = {
    # Para desenvolvimento e testes
    "small" = {
      size        = "s-2vcpu-2gb"
      max_pods    = 30
      recommended = "desenvolvimento, testes leves"
    }
    
    # Para workloads gerais
    "medium" = {
      size        = "s-4vcpu-8gb"
      max_pods    = 55
      recommended = "aplica√ß√µes web, APIs"
    }
    
    # Para workloads intensivos
    "large" = {
      size        = "s-8vcpu-16gb"
      max_pods    = 110
      recommended = "databases, processamento"
    }
    
    # Para workloads especializados
    "compute_optimized" = {
      size        = "c-8vcpu-16gb"
      max_pods    = 110
      recommended = "CPU intensivo, builds"
    }
    
    "memory_optimized" = {
      size        = "m-4vcpu-32gb"
      max_pods    = 55
      recommended = "cache, in-memory DBs"
    }
  }
}
```

### 2. Auto Scaling Inteligente

```hcl
# Configura√ß√£o de auto scaling baseada em m√©tricas
variable "autoscaling_config" {
  description = "Configura√ß√£o avan√ßada de auto scaling"
  type = object({
    scale_up_threshold   = number
    scale_down_threshold = number
    scale_up_cooldown    = string
    scale_down_cooldown  = string
  })
  default = {
    scale_up_threshold   = 80  # CPU > 80%
    scale_down_threshold = 20  # CPU < 20%
    scale_up_cooldown    = "3m"
    scale_down_cooldown  = "5m"
  }
}
```

## üîç Troubleshooting Comum

### 1. Problemas de Configura√ß√£o

#### Erro: "Invalid cluster configuration"

```bash
# Validar configura√ß√£o do Terraform
terraform validate

# Verificar plano antes de aplicar
terraform plan -detailed-exitcode

# Aplicar com logs detalhados
TF_LOG=DEBUG terraform apply
```

#### Erro: "Node pool creation failed"

```bash
# Verificar quotas da conta
doctl account get

# Verificar disponibilidade da regi√£o
doctl kubernetes options regions

# Verificar tamanhos dispon√≠veis
doctl kubernetes options sizes
```

### 2. Problemas de Upgrade

#### Auto Upgrade n√£o est√° funcionando

```hcl
# Verificar se a manuten√ß√£o est√° configurada corretamente
resource "digitalocean_kubernetes_cluster" "main" {
  auto_upgrade = true
  
  maintenance_policy {
    start_time = "04:00"
    day        = "sunday"
  }
}
```

#### Surge Upgrade causando custos altos

```hcl
# Reduzir o max_surge para controlar custos
surge_config = {
  max_surge       = "1"      # Apenas 1 node extra por vez
  max_unavailable = "0"      # Sem indisponibilidade
}
```

### 3. Comandos √öteis para Debug

```bash
# Verificar status do cluster
doctl kubernetes cluster get <cluster-name>

# Obter kubeconfig
doctl kubernetes cluster kubeconfig save <cluster-name>

# Verificar nodes
kubectl get nodes -o wide

# Verificar eventos do cluster
kubectl get events --sort-by='.metadata.creationTimestamp'

# Verificar estado dos pods
kubectl get pods --all-namespaces -o wide

# Logs do sistema
kubectl logs -n kube-system -l k8s-app=kube-proxy

# M√©tricas de recursos
kubectl top nodes
kubectl top pods --all-namespaces
```

### 4. Monitoramento e Alertas

```hcl
# Configura√ß√£o de alertas b√°sicos
resource "digitalocean_monitoring_alert_policy" "high_cpu" {
  alerts {
    email = ["devops@empresa.com"]
    slack {
      channel = "#alerts"
      url     = var.slack_webhook_url
    }
  }
  
  description = "CPU alta nos nodes do cluster"
  type        = "v1/insights/droplet/cpu"
  compare     = "GreaterThan"
  value       = 80
  window      = "5m"
  
  entities = [for pool in digitalocean_kubernetes_node_pool.pools : pool.id]
}

resource "digitalocean_monitoring_alert_policy" "high_memory" {
  alerts {
    email = ["devops@empresa.com"]
  }
  
  description = "Mem√≥ria alta nos nodes do cluster"
  type        = "v1/insights/droplet/memory_utilization_percent"
  compare     = "GreaterThan"
  value       = 85
  window      = "5m"
  
  entities = [for pool in digitalocean_kubernetes_node_pool.pools : pool.id]
}
```

## üöÄ Pr√≥ximos Passos

1. üìã Escolha a configura√ß√£o apropriada para seu ambiente
2. üîß Customize as vari√°veis conforme suas necessidades
3. üß™ Teste em ambiente de desenvolvimento primeiro
4. üìä Configure monitoramento adequado
5. üìö Consulte os [exemplos espec√≠ficos](examples/) para mais detalhes

## üìñ Links √öteis

- [Documenta√ß√£o DigitalOcean Kubernetes](https://docs.digitalocean.com/products/kubernetes/)
- [Terraform DigitalOcean Provider](https://registry.terraform.io/providers/digitalocean/digitalocean/latest/docs)
- [Kubernetes Best Practices](https://kubernetes.io/docs/concepts/configuration/overview/)

---

**Importante**: Sempre revise as configura√ß√µes em ambiente de teste antes de aplicar em produ√ß√£o.